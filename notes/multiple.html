<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="ko" xml:lang="ko"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.5.57">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>7&nbsp; 다중비교 – 의학통계학</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../site_libs/clipboard/clipboard.min.js"></script>
<script src="../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../site_libs/quarto-search/fuse.min.js"></script>
<script src="../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../">
<link href="../notes/repeatmeasure.html" rel="next">
<link href="../notes/ancova.html" rel="prev">
<script src="../site_libs/quarto-html/quarto.js"></script>
<script src="../site_libs/quarto-html/popper.min.js"></script>
<script src="../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../site_libs/quarto-html/anchor.min.js"></script>
<link href="../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "일치 없음",
    "search-matching-documents-text": "일치된 문서",
    "search-copy-link-title": "검색 링크 복사",
    "search-hide-matches-text": "추가 검색 결과 숨기기",
    "search-more-match-text": "추가 검색결과",
    "search-more-matches-text": "추가 검색결과",
    "search-clear-button-title": "제거",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "취소",
    "search-submit-button-title": "검색",
    "search-label": "검색"
  }
}</script>
<script type="text/javascript">
 window.MathJax = {
  tex: {
    macros: {
    RR: '{\\mathbb R}',                    // a simple string replacement
    hatmat:'{\\pmb X ({\\pmb X}^t {\\pmb X} )^{-1} {\\pmb X}^t}',
    bold: ['\\boldsymbol{#1}',1] ,     // this macro has one parameter
    pardiff: ['\\frac{\\partial#2}{\\partial#1}', 2, 'x'], // this macro has an optional parameter that defaults to 'x'
    pardifftwo: ['\\frac{\\partial#1}{\\partial#2}', 2]
  },
  environments: {
  braced: ["\\left\\{", "\\right\\}"]
  }
 }
};
</script>

  <script src="https://cdnjs.cloudflare.com/polyfill/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

<script type="text/javascript">
const typesetMath = (el) => {
  if (window.MathJax) {
    // MathJax Typeset
    window.MathJax.typeset([el]);
  } else if (window.katex) {
    // KaTeX Render
    var mathElements = el.getElementsByClassName("math");
    var macros = [];
    for (var i = 0; i < mathElements.length; i++) {
      var texText = mathElements[i].firstChild;
      if (mathElements[i].tagName == "SPAN") {
        window.katex.render(texText.data, mathElements[i], {
          displayMode: mathElements[i].classList.contains('display'),
          throwOnError: false,
          macros: macros,
          fleqn: false
        });
      }
    }
  }
}
window.Quarto = {
  typesetMath
};
</script>

<link rel="stylesheet" href="styles.css">
</head>

<body class="nav-sidebar floating">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" role="button" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="사이드바 전환" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
        <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="../notes/anova.html">집단의 비교</a></li><li class="breadcrumb-item"><a href="../notes/multiple.html"><span class="chapter-number">7</span>&nbsp; <span class="chapter-title">다중비교</span></a></li></ol></nav>
        <a class="flex-grow-1" role="navigation" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="사이드바 전환" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
        </a>
      <button type="button" class="btn quarto-search-button" aria-label="검색" onclick="window.quartoOpenSearch();">
        <i class="bi bi-search"></i>
      </button>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal quarto-sidebar-collapse-item sidebar-navigation floating overflow-auto">
    <div class="pt-lg-2 mt-2 text-left sidebar-header">
    <div class="sidebar-title mb-0 py-0">
      <a href="../">의학통계학</a> 
        <div class="sidebar-tools-main">
    <a href="../의학통계학.pdf" title="Download PDF" class="quarto-navigation-tool px-1" aria-label="Download PDF"><i class="bi bi-file-pdf"></i></a>
</div>
    </div>
      </div>
        <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="검색"></div>
        </div>
        </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Preface</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../notes/intro.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">1</span>&nbsp; <span class="chapter-title">서론</span></span></a>
  </div>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" role="navigation" aria-expanded="true">
 <span class="menu-text">분할표와 연관성</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" role="navigation" aria-expanded="true" aria-label="토글 섹션">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-1" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../notes/association.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">연관성의 측도</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../notes/association-test.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">연관성의 검정</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../notes/diagnose.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">진단의 평가</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" role="navigation" aria-expanded="true">
 <span class="menu-text">집단의 비교</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" role="navigation" aria-expanded="true" aria-label="토글 섹션">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-2" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../notes/anova.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">5</span>&nbsp; <span class="chapter-title">분산분석</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../notes/ancova.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">6</span>&nbsp; <span class="chapter-title">공분산분석</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../notes/multiple.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text"><span class="chapter-number">7</span>&nbsp; <span class="chapter-title">다중비교</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../notes/repeatmeasure.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">8</span>&nbsp; <span class="chapter-title">반복측정자료</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" role="navigation" aria-expanded="true">
 <span class="menu-text">생존분석</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" role="navigation" aria-expanded="true" aria-label="토글 섹션">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-3" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../notes/survival-01.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">9</span>&nbsp; <span class="chapter-title">생존함수와 위험함수</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../notes/survival-02.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">10</span>&nbsp; <span class="chapter-title">생존함수의 추정</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-4" role="navigation" aria-expanded="true">
 <span class="menu-text">Appendices</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-4" role="navigation" aria-expanded="true" aria-label="토글 섹션">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-4" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../notes/multivar.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">A</span>&nbsp; <span class="chapter-title">다변량 확률변수의 성질</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../notes/lmmtheory.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">B</span>&nbsp; <span class="chapter-title">선형혼합모형의 이론</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../references.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">References</span></a>
  </div>
</li>
      </ul>
  </li>
    </ul>
    </div>
</nav>
<div id="quarto-sidebar-glass" class="quarto-sidebar-collapse-item" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">목차</h2>
   
  <ul>
  <li><a href="#필요한-패키지" id="toc-필요한-패키지" class="nav-link active" data-scroll-target="#필요한-패키지"><span class="header-section-number">7.1</span> 필요한 패키지</a></li>
  <li><a href="#일원배치에서-평균의-비교" id="toc-일원배치에서-평균의-비교" class="nav-link" data-scroll-target="#일원배치에서-평균의-비교"><span class="header-section-number">7.2</span> 일원배치에서 평균의 비교</a></li>
  <li><a href="#두-개-이상의-가설" id="toc-두-개-이상의-가설" class="nav-link" data-scroll-target="#두-개-이상의-가설"><span class="header-section-number">7.3</span> 두 개 이상의 가설</a></li>
  <li><a href="#실험단위-오류" id="toc-실험단위-오류" class="nav-link" data-scroll-target="#실험단위-오류"><span class="header-section-number">7.4</span> 실험단위 오류</a></li>
  <li><a href="#다중비교" id="toc-다중비교" class="nav-link" data-scroll-target="#다중비교"><span class="header-section-number">7.5</span> 다중비교</a></li>
  <li><a href="#다중비교-방법" id="toc-다중비교-방법" class="nav-link" data-scroll-target="#다중비교-방법"><span class="header-section-number">7.6</span> 다중비교 방법</a>
  <ul class="collapse">
  <li><a href="#다중비교-방법을-적용하지-않는-경우" id="toc-다중비교-방법을-적용하지-않는-경우" class="nav-link" data-scroll-target="#다중비교-방법을-적용하지-않는-경우"><span class="header-section-number">7.6.1</span> 다중비교 방법을 적용하지 않는 경우</a></li>
  <li><a href="#본페로니-수정bonferroni-correction" id="toc-본페로니-수정bonferroni-correction" class="nav-link" data-scroll-target="#본페로니-수정bonferroni-correction"><span class="header-section-number">7.6.2</span> 본페로니 수정(Bonferroni correction)</a></li>
  <li><a href="#tukey의-hsd" id="toc-tukey의-hsd" class="nav-link" data-scroll-target="#tukey의-hsd"><span class="header-section-number">7.6.3</span> Tukey의 HSD</a></li>
  <li><a href="#fdr-방법" id="toc-fdr-방법" class="nav-link" data-scroll-target="#fdr-방법"><span class="header-section-number">7.6.4</span> FDR 방법</a></li>
  <li><a href="#dunnett-비교" id="toc-dunnett-비교" class="nav-link" data-scroll-target="#dunnett-비교"><span class="header-section-number">7.6.5</span> Dunnett 비교</a></li>
  </ul></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default"><nav class="quarto-page-breadcrumbs quarto-title-breadcrumbs d-none d-lg-block" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="../notes/anova.html">집단의 비교</a></li><li class="breadcrumb-item"><a href="../notes/multiple.html"><span class="chapter-number">7</span>&nbsp; <span class="chapter-title">다중비교</span></a></li></ol></nav>
<div class="quarto-title">
<h1 class="title"><span id="sec-multiple" class="quarto-section-identifier"><span class="chapter-number">7</span>&nbsp; <span class="chapter-title">다중비교</span></span></h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  


</header>


<section id="필요한-패키지" class="level2" data-number="7.1">
<h2 data-number="7.1" class="anchored" data-anchor-id="필요한-패키지"><span class="header-section-number">7.1</span> 필요한 패키지</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(kableExtra)</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggplot2)</span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(here)</span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(car)</span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(agricolae)</span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(DescTools)</span></code><button title="클립보드 복사" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="일원배치에서-평균의-비교" class="level2" data-number="7.2">
<h2 data-number="7.2" class="anchored" data-anchor-id="일원배치에서-평균의-비교"><span class="header-section-number">7.2</span> 일원배치에서 평균의 비교</h2>
<p>분산분석표를 이용한 F-검정으로 귀무가설을 기각하면 모든 처리 수준의 평균이 같지 않다는 결론을 내리고<br>
어떤 집단 간에 평균의 차이가 유의한지 더 분석해야 한다. 평균 차이에 대한 신뢰구간과 가설 검정은 아래와 같이 주어진다.</p>
<p>두 수준 평균의 차이 <span class="math inline">\(\delta_{ij} = \mu_i - \mu_j\)</span> 에 대한 <span class="math inline">\(100(1-\alpha)\)</span> % 신뢰구간은 다음과 같이 주어진다.</p>
<p><span id="eq-twomeanci"><span class="math display">\[
( \bar {y}_{i.} - \bar {y}_{j.})   \pm t(1-\alpha/2, \phi_E) \sqrt{ \frac{2MS_E}{r}}
\tag{7.1}\]</span></span></p>
<p>두 평균의 차이 <span class="math inline">\(\delta_{ij}\)</span> 에 대한 가설을 검정은 유의 수준 <span class="math inline">\(\alpha\)</span>에서 다음과 같은 조건을 만족하면 위의 귀무가설을 기각한다.</p>
<p><span id="eq-lsd"><span class="math display">\[
\left | \bar {y}_{i.} - \bar {y}_{j.} \right | &gt; t(1-\alpha/2, \phi_E) \sqrt{ \frac{2MS_E}{r}}
\tag{7.2}\]</span></span></p>
<p>식 <a href="#eq-lsd" class="quarto-xref"><span>7.2</span></a> 에서 검정을 위한 조건의 우변을 최소유의차(least significant difference; LSD) 라고 부른다. 두 수준의 차이가 유의하려면 두 평균 차이의 절대값이 최소한 최소유의차의 값보다 커야한다.</p>
<p><span class="math display">\[  \text{LSD} =t(1-\alpha/2, \phi_E) \sqrt{ \frac{2MS_E}{r}}  \]</span></p>
</section>
<section id="두-개-이상의-가설" class="level2" data-number="7.3">
<h2 data-number="7.3" class="anchored" data-anchor-id="두-개-이상의-가설"><span class="header-section-number">7.3</span> 두 개 이상의 가설</h2>
<p>일원배치 계획에서 수준의 개수가 a 개 인 경우 처리 수준들의 차이에 대하여 비교를 한다면 <span class="math inline">\(a \choose 2\)</span> 개의 가설검정을 수행해야 한다. 예를 들어 처리 수준이 3개 있는 경우 다음과 같이 3개의 조합에 대하여 가설 검정을 수행할 수 있다.</p>
<p><span id="eq-multihypo"><span class="math display">\[
H_{01}: \mu_1 = \mu_2, \quad H_{02}: \mu_2 = \mu_3, \quad H_{03}: \mu_3 =\mu_1
\tag{7.3}\]</span></span></p>
<p>가설검정에서 사용되는 유의수준(significance level, <span class="math inline">\(\alpha\)</span>)에 대하여 생각해 보자. 지금까지 가설검정을 수행할 때 <strong>유의수준 5%</strong> 라는 말을 사용해 왔는데 이것이 무슨 의미를 가지는지 알아보자.</p>
<p>유의수준 5%라는 것은 수행하는 가설검정에서 귀무가설이 옳은 경우에 기각하는 확률을 말한다. 예를 들어 <a href="#eq-multihypo" class="quarto-xref"><span>7.3</span></a> 의 3개의 검정에 대하여 각각 t-검정을 수행하는 경우 귀무가설이 옳은데 우연하게 자료가 극단적으로 나와서 귀무가설을 기각하고 대립가설을 채택하는 확률이 유의수준이며 보통 5%를 사용한다. 이러한 오류를 제 1종의 오류(Type I error; false discovery error;false positve error)라고 한다.</p>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
노트
</div>
</div>
<div class="callout-body-container callout-body">
<p>제 1종의 오류(Type I Error): 실제로는 유의하지 않지만 검정 결과 유의하다고 판단하는 경우이며 다음과 같은 다른 이름으로는 불린다.</p>
<ul>
<li>False discovery error (FDE, 거짓 양성 오류)</li>
<li>False positive error (FPE)</li>
</ul>
</div>
</div>
<p>위 <a href="#eq-multihypo" class="quarto-xref"><span>7.3</span></a> 에서 처럼 3개의 가설 검정을 동시에 실시한다면 각각의 가설검정에서 제 1 종의 오류를 범할 확률은 5%이다. 그런데 3개의 가설 검정을 동시에 실행하므로 다음과 같이 3개의 검정을 합쳐서 다음과 같은 확률에 관심이 있을 수 있다.</p>
<p><strong>3개의 가설검정을 동시에 수행할 때 제 1종의 오류가 최소한 1번 발생할 확률은 얼마인가?</strong></p>
<p>세 개의 가설검정을 동시에 수행하는 경우 세 검정 모두 제 1 종의 오류를 범하거나 두 개 또는 하나의 검정에서 제 1 종의 오류를 범할 사건의 확률은 얼마나 될까? 5%보다 작을까 아니면 클까? 또는 5%인가? 간단한 확률 공식을 이용하여 알아보자.</p>
</section>
<section id="실험단위-오류" class="level2" data-number="7.4">
<h2 data-number="7.4" class="anchored" data-anchor-id="실험단위-오류"><span class="header-section-number">7.4</span> 실험단위 오류</h2>
<p>일단 두 개의 검정 <span class="math inline">\(H_{01}\)</span> 과 <span class="math inline">\(H_{02}\)</span>을 각각 유의수준 <span class="math inline">\(\alpha=0.05\)</span>로서 동시에 수행 한다고 가정하고 다음과 같은 사건을 정의한다.</p>
<ul>
<li><span class="math inline">\(A_1\)</span>: <span class="math inline">\(H_{01}\)</span> 검정에서 제 1 종의 오류를 범하는 사건</li>
<li><span class="math inline">\(A_2\)</span>: <span class="math inline">\(H_{02}\)</span> 검정에서 제 1 종의 오류를 범하는 사건</li>
</ul>
<p>각 검정에서 제 1 종의 오류를 범할 확률을 <span class="math inline">\(\alpha\)</span>라고 가정하자.</p>
<p><span class="math display">\[ P( A_1 ) =  P(A_2) = \alpha =0.05 \]</span></p>
<p>이제 두개의 가설검정을 동시에 수행하는 경우 <strong>제 1 종의 오류를 최소한 1번 범하는 사건</strong>은 <span class="math inline">\(P(A_1 \cup A_2)\)</span> 이며 여사건의 확률공식을 이용하면 다음과 같이 나타낼 수 있다.</p>
<p><span class="math display">\[ P( A_1 \cup A_2 ) = 1- P(A_1^c \cap A^c_2 ) \]</span></p>
<p>여기서 우리는 <span class="math inline">\(P(A_1^c)=P(A_2^c)=1-0.05=0.95\)</span>를 알 수 있지만 두 사건의 교집합에 대한 확률은 계산하기 쉽지 않다. 왜냐하면 두 사건 <span class="math inline">\(A_1\)</span>과 <span class="math inline">\(A_2\)</span>가 일반적으로 독립이 아니어서 두 확률의 곱으로 쉽게 나타낼 수 없다.</p>
<p>만약에 두 사건이 독립이라면 다음과 같은 결과가 나온다. 즉 두 개의 독립인 가설검정을 동시에 수행하는 경우 최소한 1번의 제 1 종의 오류를 범하는 사건의 학률은 0.0975로 5%의 두 배 정도가 된다.</p>
<p><span class="math display">\[ P( A_1 \cup A_2 ) = 1- P(A_1^c \cap A^c_2 ) =1-P(A_1^c)P(A^c_2 ) = 1-(1-0.05)^2 = 0.0975 &gt; 0.05 \]</span></p>
<p>만약 <span class="math inline">\(k\)</span> 개의 독립인 가설검정을 동시에 수행하는 경우 제 1 종의 오류를 최소한 1번 이라도 범하는 사건의 학률은 <span class="math inline">\(1-(1-0.05)^k\)</span>으로 급격하게 증가한다. 예를 들어 <span class="math inline">\(k=6\)</span>인 경우 26.5% 로 5%의 5 배가 된다. 여기서 유의할 점은 이러한 결과는 모든 가설검정이 독립이고 여러 개의 가설검정들을 동시에 고려하는 경우이다.</p>
<p>즉, 두 개 이상의 가설검정을 동시에 고려해서 <strong>제 1 종의 오류를 최소한 1번 범할 경우</strong>를 오류라고 한다면 그 확률은 고려하는 검정의 개수가 증가함에 따라 빠르게 커진다.</p>
<p>이렇게 두 개 이상의 가설검정을 동시에 고려해서 계산하는 오류의 확률을 <strong>실험단위 오류(Experiment-wise error 또는 Family-wise error)</strong>라고 하며 반대로 가설검정을 동시에 고려하지 않고 개별적로 생각하는 오류를 <strong>개별단위 오류(Individual-wise error)</strong>라고 한다.</p>
<div id="exm-dunnett" class="theorem example">
<p><span class="theorem-title"><strong>보기 7.1 (제어집단이 있는 임상실험)</strong></span> 임상실험에서 신약(처리 1)의 효과가 위약(처리 2)보다는 우월하다는 사실을 입증하는 것이 일반적이다. 그런데 기존의 약(처리 3)보다 우월하다는 사실을 동시에 입증하려고 하는 경우도 있다. 이러한 경우 다음과 같은 두 개의 가설을 동시에 수행해야 한다.</p>
<p><span class="math display">\[ H_{01}: \mu_1 = \mu_2, \quad H_{02}: \mu_1 = \mu_3 \]</span></p>
<p>이러한 경우 신약(처리 1)을 제어 집단이라고 부르며 다른 두 그룹들(처이 2,3)과 각각 비교해야 한다.</p>
<p>3개의 집단(신약, 위약, 기존의 약)을 가진 일원배치법으로 실험을 수행한 경우 첫 번째 가설 <span class="math inline">\(H_{01}\)</span>은 <span class="math inline">\({\bar y}_{1.} - {\bar y}_{2.}\)</span>를 이용하고 두 번째 가설 <span class="math inline">\(H_{02}\)</span>은 <span class="math inline">\({\bar y}_{1.} - {\bar y}_{3.}\)</span>을 이용하여 가설검정을 한다.</p>
<p>이러한 경우 각 검정에 대하여 유의 수준을 5% (개별단위 오류를 범할 확률이 5%) 라고 해도 실험단위 오류를 범할 확률은 5% 보다 크다.</p>
</div>
</section>
<section id="다중비교" class="level2" data-number="7.5">
<h2 data-number="7.5" class="anchored" data-anchor-id="다중비교"><span class="header-section-number">7.5</span> 다중비교</h2>
<p>다시 실험 단위 오류의 계산으로 돌아가서 만약에 두 사건이 독립이 아닌 경우에 실험적 오류를 통제할 수 있는, 즉 5%보다 작거나 같게 하는 방법에 대해서 알아보자 두 사건이 독립이 아닌 일반적인 경우에 확률 공식을 이용하여 다음과 같은 부등식을 얻을 수 있다.</p>
<p><span class="math display">\[ P( A_1 \cup A_2 )  \le  P( A_1 ) + P( A_2 ) = (2)(0.05) = 0.1 \]</span></p>
<p>위의 결과를 보면 만약에 두 개의 가설검정을 동시에 수행하는 경우 각 가설검정에 대한 개별단위의 제 1 종 오류에 대한 확률을 반으로 줄이면(0.05/2=0.025) 실험적 오류가 5%보다 작거나 같게 된다.</p>
<p><span class="math display">\[ P( A_1 \cup A_2 )  \le  P( A_1 ) + P( A_2 ) = (2)(0.05/2) = 0.05 \]</span></p>
<p>위에서 보인 같은 논리로서 <span class="math inline">\(k\)</span> 개의 가설검정을 동시에 수행하는 경우 각 가설검정에 대한 개별적 1종 오류의 확률을 <span class="math inline">\(k\)</span>배 줄이면(<span class="math inline">\(0.05/k\)</span>) 실험단위 오류가 5%보다 작거나 같게 된다.</p>
<p><span class="math display">\[ P( A_1 \cup A_2 \cup ... \cup A_k )  \le   (k)(0.05/k) = 0.05 \]</span></p>
<p>여기서 한 가지 유의할 점은 만약 두 개의 가설이 완전히 종속이거나(<span class="math inline">\(A_1 = A_2\)</span>) 거의 종속이면 실험적 오류는 거의 변하지 않는다. 따라서 개별단위 1종 오류에 대한 수정은 거의 필요하지 않다.</p>
<p><span class="math display">\[ P( A_1 \cup A_2 ) = 1- P(A_1^c \cap A^c_2 ) \approx 1-P(A_1^c) = 0.05 \]</span></p>
<p>이렇게 실험단위 오류를 통제하기 위하여(5%보다 작거나 같게) 각 가설에 대한 개별단위 1 종 오류의 확률(유의수준)를 보정하는 방법을 <strong>다중비교(mutiple comparison)</strong> 라고 한다.</p>
<p>위에서 제시한 개별단위 1종 오류를 <span class="math inline">\(k\)</span>배로 줄이는(0.05/k) 방법을 특별하게 본페로니 수정(Bonferroni correction)이라고 부른다. 본페로니 수정은 가장 보수적인 수정(most conservative correction)이라고 불리는데 그 이유는 실험적 오류가 가질 수 있는 가장 큰 값을 가정하고 보정하기 때문에 각각 수정한 개별단위 오류에 대한 유의수준이 너무 작게 되어(<span class="math inline">\(0.05/k\)</span>) 귀무가설의 기각이 매우 힘들기 떄문이다.</p>
<p>만약 <span class="math inline">\(k\)</span>개의 가설 검정에 본페로니 수정을 적용한다면 신뢰구간과 가설검정은 다음과 같이 수정된다.</p>
<p>두 수준 평균의 차이 <span class="math inline">\(\delta_{ij} = \mu_i - \mu_j\)</span> 에 대한 본페로니 수정 신뢰구간은 다음과 같이 주어진다.</p>
<p><span id="eq-twomeancibon"><span class="math display">\[
( \bar {y}_{i.} - \bar {y}_{j.})   \pm t(1-\alpha/(2k), \phi_E) \sqrt{ \frac{2MS_E}{r}}
\tag{7.4}\]</span></span></p>
<p>두 평균의 차이 <span class="math inline">\(\delta_{ij}\)</span> 에 대한 가설을 본페로니 수정 검정은 다음과 같은 조건을 만족하면 귀무가설을 기각한다.</p>
<p><span id="eq-lsdbon"><span class="math display">\[
\left | \bar {y}_{i.} - \bar {y}_{j.} \right | &gt; t(1-\alpha/(2k), \phi_E) \sqrt{ \frac{2MS_E}{r}}
\tag{7.5}\]</span></span></p>
<p>기각역에 본페로니 수정을 하는 것은 윈래의 p-값에 가설의 개수 <span class="math inline">\(k\)</span> 를 곱하여 수정 p-값을 사용하는 것과 같다.</p>
<p><span id="eq-pbon"><span class="math display">\[
   \text{Bonferoni adjusted p-value } = k
   \times \text{ unadjusted p-value }
\tag{7.6}\]</span></span></p>
<p>일반적으로 각 가설검정들은 완전히 독립도 아니고 또한 완전한 종속도 아니다. 따라서 실험단위 오류는 각 가설 검정들이 어떻게 확률적으로 관련되어 있느냐에 따라 매우 달라진다. 이러한 이유로 인하여 다중비교의 방법은 매우 다양하며, 선택한 방법에 따라서 검정의 결과도 매우 달라질 수있는 사실에 유의해야 한다. 다중비교의 방법을 선택하는 것은 매우 어려운 일이다.</p>
<div class=".{callout-note}">
<p>가설이 2개 이상 있는 경우 실험단위의 오류의 확률을 제어해야 하는지에 대한 판단은 상황에 따라서 달라진다.</p>
<p>앞에서 살펴본 임상실험의 예와 같이 <strong>중요한 의사 결정</strong>을 동시에 수행하는 2개 이상의 검정 결과에 따라서 해야할 경우 주로 다중 비교를 적용한다.</p>
<p>또한 다중 비교 방법은 실험의 설계와 목적에 따라서 많은 방법들이 존재한다. 주어진 실험 계획과 목적에 부합하는 다중 비교법을 선택해야 한다.</p>
<p>반면 <strong>탐색적인 목적</strong>으로 여러 개의 가설 검정을 동시에 수행하는 경우에는 다중비교를 적용하지 않거나 다중 비교보다 더 유연한 False Discovery Rate 방법(<a href="https://en.wikipedia.org/wiki/False_discovery_rate">참조</a>) 을 사용한다.</p>
</div>
</section>
<section id="다중비교-방법" class="level2" data-number="7.6">
<h2 data-number="7.6" class="anchored" data-anchor-id="다중비교-방법"><span class="header-section-number">7.6</span> 다중비교 방법</h2>
<p>이제 다중비교를 수행할 수 있는 중요한 방법들을 알아보고 저혈당 임상실험 예제에 적용해 보자.</p>
<p>앞에서 살펴본 저혈당 임상실험은 5개의 처리가 있다. 따라서 <span class="math inline">\({5 \choose 2} =10\)</span> 개의 가설 검정(또는 신뢰구간)을 수행해야 한다.</p>
<p>5개 치료집단(<code>treat</code>)이 처리 수준이며 각 처리수준 은 <code>1</code>, <code>2</code>, <code>3</code>, <code>4</code>, <code>5</code> 로 표시된다.</p>
<section id="다중비교-방법을-적용하지-않는-경우" class="level3" data-number="7.6.1">
<h3 data-number="7.6.1" class="anchored" data-anchor-id="다중비교-방법을-적용하지-않는-경우"><span class="header-section-number">7.6.1</span> 다중비교 방법을 적용하지 않는 경우</h3>
<p>먼저 다중비교 방법을 적용하지 않는 경우 결과를 보자. 함수 <code>LSD.test</code> 에서 <code>p.adj=c("none")</code>를 지정하면 다중 비교를 적용하지 않는다. 명령문 <code>p.adj</code> 를 지정하지 않으면 수정을 하지 않는 LSD 방법에 의한 신뢰 구간 <a href="#eq-twomeanci" class="quarto-xref"><span>7.1</span></a> 와 검정 방법 <a href="#eq-lsd" class="quarto-xref"><span>7.2</span></a> 로 구한 결과를 준다.</p>
<p>LSD 방법을 적용하는 경우 유의한 차이를 보이는 조합이 4개로 나타났다 (1-5,2-5,3-5,4-5).</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a>diabetes <span class="ot">&lt;-</span> <span class="fu">read.csv</span>(<span class="fu">here</span>(<span class="st">"data"</span>, <span class="st">"chapter-5-data.txt"</span>), <span class="at">sep=</span><span class="st">''</span>, <span class="at">header =</span> F)</span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(diabetes) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"treat"</span>, <span class="st">"baseline"</span>, <span class="st">"response"</span>)</span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a>diabetes<span class="sc">$</span>treat<span class="ot">&lt;-</span> <span class="fu">factor</span>(diabetes<span class="sc">$</span>treat)</span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a>diabetes <span class="ot">&lt;-</span> diabetes <span class="sc">%&gt;%</span> <span class="fu">arrange</span>(treat)</span></code><button title="클립보드 복사" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a>anova.res <span class="ot">&lt;-</span> <span class="fu">aov</span>(response<span class="sc">~</span>treat,<span class="at">data=</span>diabetes)  <span class="co">#일원배치</span></span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a>test1 <span class="ot">&lt;-</span> <span class="fu">LSD.test</span>(anova.res, <span class="st">"treat"</span>, <span class="at">alpha =</span> <span class="fl">0.05</span>, <span class="at">group =</span> <span class="cn">FALSE</span>, <span class="at">console =</span> <span class="cn">FALSE</span>, <span class="at">p.adj=</span><span class="fu">c</span>(<span class="st">"none"</span>) )</span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a>test1<span class="sc">$</span>comparison</span></code><button title="클립보드 복사" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>      difference pvalue signif.        LCL       UCL
1 - 2      2.825 0.2405         -2.1014081  7.751408
1 - 3      3.625 0.1376         -1.3014081  8.551408
1 - 4      2.250 0.3458         -2.6764081  7.176408
1 - 5      9.450 0.0010     ***  4.5235919 14.376408
2 - 3      0.800 0.7341         -4.1264081  5.726408
2 - 4     -0.575 0.8069         -5.5014081  4.351408
2 - 5      6.625 0.0118       *  1.6985919 11.551408
3 - 4     -1.375 0.5608         -6.3014081  3.551408
3 - 5      5.825 0.0235       *  0.8985919 10.751408
4 - 5      7.200 0.0071      **  2.2735919 12.126408</code></pre>
</div>
</div>
</section>
<section id="본페로니-수정bonferroni-correction" class="level3" data-number="7.6.2">
<h3 data-number="7.6.2" class="anchored" data-anchor-id="본페로니-수정bonferroni-correction"><span class="header-section-number">7.6.2</span> 본페로니 수정(Bonferroni correction)</h3>
<p>이제 다중비교 방법 중에 가장 보수적인 본페로니 수정(Bonferroni correction)을 적용해 보자. 함수 <code>LSD.test</code> 에서 <code>p.adj=c("bonferroni")</code>를 이용한다.</p>
<p>아래의 결과는 본페로니 수정 방법에 의한 신뢰 구간 <a href="#eq-twomeancibon" class="quarto-xref"><span>7.4</span></a> 와 검정 방법 <a href="#eq-lsdbon" class="quarto-xref"><span>7.5</span></a> 으로 구한 결과이다.</p>
<p>본페로니 수정이 적용된 신뢰구간은 LSD 방법의 신뢰구간보다 길며 수정된 p-값 <a href="#eq-pbon" class="quarto-xref"><span>7.6</span></a> 은 LSD 방법으로 구한 값의 10배이다.</p>
<p>LSD 방법을 적용하는 경우 유의한 차이를 보이는 조합이 4개로 나타났는데(1-5,2-5,3-5,4-5) 본페로니 수정을 적용한 경우에는 1개로 줄어 들었다(1-5).</p>
<p>수정한 p-값이 1이 초과하면 확률이기 때문에 1로 주어진다.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a>test2 <span class="ot">&lt;-</span> <span class="fu">LSD.test</span>(anova.res, <span class="st">"treat"</span>, <span class="at">alpha =</span> <span class="fl">0.05</span>, <span class="at">group =</span> <span class="cn">FALSE</span>, <span class="at">console =</span> <span class="cn">FALSE</span>, <span class="at">p.adj=</span><span class="fu">c</span>(<span class="st">"bonferroni"</span>) )</span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a>test2<span class="sc">$</span>comparison</span></code><button title="클립보드 복사" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>      difference pvalue signif.        LCL       UCL
1 - 2      2.825 1.0000         -4.7700036 10.420004
1 - 3      3.625 1.0000         -3.9700036 11.220004
1 - 4      2.250 1.0000         -5.3450036  9.845004
1 - 5      9.450 0.0097      **  1.8549964 17.045004
2 - 3      0.800 1.0000         -6.7950036  8.395004
2 - 4     -0.575 1.0000         -8.1700036  7.020004
2 - 5      6.625 0.1177         -0.9700036 14.220004
3 - 4     -1.375 1.0000         -8.9700036  6.220004
3 - 5      5.825 0.2355         -1.7700036 13.420004
4 - 5      7.200 0.0709       . -0.3950036 14.795004</code></pre>
</div>
</div>
</section>
<section id="tukey의-hsd" class="level3" data-number="7.6.3">
<h3 data-number="7.6.3" class="anchored" data-anchor-id="tukey의-hsd"><span class="header-section-number">7.6.3</span> Tukey의 HSD</h3>
<p>함수<code>TukeyHSD</code>는 분산분석을 실행한 결과를 이용하여 다중비교 방법 중 가장 많이 이용되는 Tukey’s Honest Significant Difference (HSD) 방법으로 다중비교를 제공한다.</p>
<p>Tukey의 HSD는 너무 보수적인 결과를 주는 본페로니 수정을 개선한 것이다. 따라서 Tukey의 HSD 에서 얻은 결과는 수정하지 않는 LDS 의 결과와 Bonferoni 방법의 중간에 있다고 할 수 있다.</p>
<p>Tukey의 HSD 에서는 본페로니와 유사하게 2개의 조합(1-5,4-5)만이 유의한 차이가 있다고 나타난다.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a>test3 <span class="ot">&lt;-</span> <span class="fu">TukeyHSD</span>(anova.res, <span class="at">conf.level =</span> <span class="fl">0.95</span>, <span class="at">ordered=</span><span class="cn">FALSE</span>)</span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a>test3</span></code><button title="클립보드 복사" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>  Tukey multiple comparisons of means
    95% family-wise confidence level

Fit: aov(formula = response ~ treat, data = diabetes)

$treat
      diff        lwr         upr     p adj
2-1 -2.825  -9.962104  4.31210359 0.7391923
3-1 -3.625 -10.762104  3.51210359 0.5376665
4-1 -2.250  -9.387104  4.88710359 0.8628887
5-1 -9.450 -16.587104 -2.31289641 0.0073287
3-2 -0.800  -7.937104  6.33710359 0.9965642
4-2  0.575  -6.562104  7.71210359 0.9990516
5-2 -6.625 -13.762104  0.51210359 0.0751342
4-3  1.375  -5.762104  8.51210359 0.9737551
5-3 -5.825 -12.962104  1.31210359 0.1380280
5-4 -7.200 -14.337104 -0.06289641 0.0475257</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(test3)</span></code><button title="클립보드 복사" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="multiple_files/figure-html/unnamed-chunk-5-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="fdr-방법" class="level3" data-number="7.6.4">
<h3 data-number="7.6.4" class="anchored" data-anchor-id="fdr-방법"><span class="header-section-number">7.6.4</span> FDR 방법</h3>
<p>False Discovery Rate (FDR)는 다중 비교에서 기각된 가설 중 실제로 제 1 종 오류가 일어난 비율, 즉 실제 거짓 양성인 비율을 의미한다.</p>
<p>수식적으로 FDR은 다음과 같이 표현할 수 있다.</p>
<p><span id="eq-fdr"><span class="math display">\[
  \text{FDR} = \mathbb{E} \left[ \frac{V}{R} \right] \quad (R &gt; 0), \quad
\tag{7.7}\]</span></span></p>
<p>위의 <a href="#eq-fdr" class="quarto-xref"><span>7.7</span></a> 에서 <span class="math inline">\(V\)</span> 와 <span class="math inline">\(R\)</span> 은 다음과 같이 정의되며</p>
<ul>
<li><span class="math inline">\(V\)</span>: 거짓 양성(False Positives)의 수</li>
<li><span class="math inline">\(R\)</span>: 유의하다고 판단된 전체 가설의 수</li>
</ul>
<p>FDR은 기대값을 의미하며, 여기서는 비율의 평균을 의미한다.</p>
<p>FDR을 제어하기 위해 여러 가지 방법이 제안되었으며 이 중 가장 널리 사용되는 방법은 Benjamini-Hochberg 절차(BH FDR) 이고 검정의 절차는 다음과 같다.</p>
<p>먼저 <span class="math inline">\(m\)</span> 개의 가설 검정을 한다고 가정하자.</p>
<ol type="1">
<li>유의 수준 <span class="math inline">\(\alpha\)</span> 에 대해, 모든 p-값을 오름차순으로 정렬한다. 정렬된 p-값 <span class="math inline">\(p_{(i)}\)</span> 에 해당하는 귀무가설을 <span class="math inline">\(H_{(i)}\)</span> 라고 하자.</li>
</ol>
<p><span class="math display">\[  p_{(1)} ~ \le ~ p_{(2)} ~ \le ~ ... ~ \le ~ p_{(m)} \]</span></p>
<ol start="2" type="1">
<li>오름차순으로 정렬한 경우 <span class="math inline">\(i\)</span> 번째 p-값 <span class="math inline">\(p_{(i)}\)</span> 에 해당하는 새로운 유의수준 <span class="math inline">\(\alpha^*_i\)</span> 을 다음과 같이 계산한다.</li>
</ol>
<p><span class="math display">\[  \alpha^*_i = \frac{i}{m} \alpha \]</span></p>
<ol start="3" type="1">
<li><span class="math inline">\(p_{(i)} \le \alpha^*_i\)</span> 를 만족하는 가장 큰 <span class="math inline">\(i=i^*\)</span> 를 찾는다.</li>
</ol>
<p><span class="math display">\[ i^* = \max \{ i: p_{(i)} \leq \alpha^*_i \} \]</span></p>
<ol start="4" type="1">
<li><span class="math inline">\(i^*\)</span> 보다 작거나 같은 p-값을 유의하다고 판단한다. 즉, 가설 <span class="math inline">\(H_{(1)}, H_{(2)}, \dots, H_{(i^*)}\)</span> 를 기각한다.</li>
</ol>
<p>정렬된 p-값 중에서 <span class="math inline">\(p_{(i^*)}\)</span> 까지의 가설을 기각하고 나머지 가설은 기각하지 않는다.</p>
<p>이러한 BH 절차는 FDR을 유의수준 <span class="math inline">\(\alpha\)</span> 이하로 유지하도록 설계된 방법이다. BH 절차는 본페로니 수정보다 덜 보수적이며, 거짓 발견의 비율을 직접 제어하므로 검정력을 유지할 수 있다는 장점이 있다.</p>
<p>FDR 조정은 생물학, 유전학, 심리학 등 여러 분야에서 사용되며, 특히 유전자 발현 연구와 같은 대량 데이터 분석에서 주로 사용된다. 예를 들어 유전자 발현 데이터에서 수천 개의 유전자에 대해 차이가 있는지 검정하는 경우 FDR 조정을 통해 거짓 양성을 제어할 수 있다. 하지만, 가설들 간의 상관관계에 민감하게 작동할 수 있다.</p>
<p>이제 위에서 설명한 방법으로 저혈당 임상실험에 FDR을 적용해 보자.</p>
<p>아래 코드는 <code>LSD</code> 방법으로 계산된 p-값을 작은 순서대로 정렬하고 BH 절차를 통하여 새로운 유의수준 <span class="math inline">\(\alpha_i\)</span> (<code>BH_alpha</code>) 를 계산하여 FDR을 적용한 결과를 보여준다.</p>
<p>10개의 가설 검정 중 BH 절차를 적용한 결과는 3개의 가설이 유의하다고 판단되었다.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a>ordinary_p <span class="ot">&lt;-</span> test1<span class="sc">$</span>comparison <span class="sc">%&gt;%</span> dplyr<span class="sc">::</span><span class="fu">select</span>(pvalue)</span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a>ordered_p <span class="ot">&lt;-</span> ordinary_p <span class="sc">%&gt;%</span> <span class="fu">arrange</span>(pvalue)</span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a>ordered_p <span class="ot">&lt;-</span> ordered_p <span class="sc">%&gt;%</span> dplyr<span class="sc">::</span><span class="fu">mutate</span>(<span class="at">BH_alpha =</span> <span class="fl">0.05</span><span class="sc">*</span> (<span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(pvalue))<span class="sc">/</span><span class="fu">length</span>(pvalue))</span>
<span id="cb10-5"><a href="#cb10-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-6"><a href="#cb10-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-7"><a href="#cb10-7" aria-hidden="true" tabindex="-1"></a>ordered_p</span></code><button title="클립보드 복사" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>      pvalue BH_alpha
1 - 5 0.0010    0.005
4 - 5 0.0071    0.010
2 - 5 0.0118    0.015
3 - 5 0.0235    0.020
1 - 3 0.1376    0.025
1 - 2 0.2405    0.030
1 - 4 0.3458    0.035
3 - 4 0.5608    0.040
2 - 3 0.7341    0.045
2 - 4 0.8069    0.050</code></pre>
</div>
</div>
<p><code>stats</code> 패키지에 <code>p.adjust</code> 함수의 <code>BH</code> 방법을 활용하면 FDR 제어 방법을 적용한 수정된 p-값을 계산할 수 있다. FDR 제어 방법을 적용한 수정된 p-값 은 원래 p-값보다 크며 0.05 보다 작으면 가설을 기각할 수 있다.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a>FDR_BH_p <span class="ot">&lt;-</span> <span class="fu">p.adjust</span>(ordinary_p<span class="sc">$</span>pvalue, <span class="at">method =</span> <span class="st">"BH"</span>)</span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a>FDR_BH_p</span></code><button title="클립보드 복사" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> [1] 0.40083333 0.27520000 0.49400000 0.01000000 0.80690000 0.80690000
 [7] 0.03933333 0.70100000 0.05875000 0.03550000</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a>new_p <span class="ot">&lt;-</span> ordinary_p <span class="sc">%&gt;%</span> dplyr<span class="sc">::</span><span class="fu">mutate</span>(<span class="at">pvalue_FDR =</span> FDR_BH_p)</span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a>new_p</span></code><button title="클립보드 복사" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>      pvalue pvalue_FDR
1 - 2 0.2405 0.40083333
1 - 3 0.1376 0.27520000
1 - 4 0.3458 0.49400000
1 - 5 0.0010 0.01000000
2 - 3 0.7341 0.80690000
2 - 4 0.8069 0.80690000
2 - 5 0.0118 0.03933333
3 - 4 0.5608 0.70100000
3 - 5 0.0235 0.05875000
4 - 5 0.0071 0.03550000</code></pre>
</div>
</div>
<p>위에서 살펴본 수정을 하지 않은 LSD 방법, Tukey의 HSD, FDR의 BH 절차와 본페로니 수정 방법에서 계산된 p-값을 아래 표에서 비교하였다. 각 수정된 p-값이 유의수준 (0.05) 보다 작으면 유의한 차이가 있다고 판단한다.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a>comp_pval <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">comp_group=</span><span class="fu">rownames</span>(test1<span class="sc">$</span>comparison),</span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a><span class="at">LSD =</span> test1<span class="sc">$</span>comparison<span class="sc">$</span>pvalue,</span>
<span id="cb16-3"><a href="#cb16-3" aria-hidden="true" tabindex="-1"></a><span class="at">FDR_BH =</span> <span class="fu">p.adjust</span>(test1<span class="sc">$</span>comparison<span class="sc">$</span>pvalue, <span class="at">method =</span> <span class="st">"BH"</span>),</span>
<span id="cb16-4"><a href="#cb16-4" aria-hidden="true" tabindex="-1"></a><span class="at">HSD =</span> <span class="fu">round</span>(<span class="fu">as.numeric</span>(test3<span class="sc">$</span>treat[,<span class="dv">4</span>]),<span class="dv">4</span>),</span>
<span id="cb16-5"><a href="#cb16-5" aria-hidden="true" tabindex="-1"></a><span class="at">Bonf =</span> test2<span class="sc">$</span>comparison<span class="sc">$</span>pvalue</span>
<span id="cb16-6"><a href="#cb16-6" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb16-7"><a href="#cb16-7" aria-hidden="true" tabindex="-1"></a>comp_pval</span></code><button title="클립보드 복사" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>   comp_group    LSD     FDR_BH    HSD   Bonf
1       1 - 2 0.2405 0.40083333 0.7392 1.0000
2       1 - 3 0.1376 0.27520000 0.5377 1.0000
3       1 - 4 0.3458 0.49400000 0.8629 1.0000
4       1 - 5 0.0010 0.01000000 0.0073 0.0097
5       2 - 3 0.7341 0.80690000 0.9966 1.0000
6       2 - 4 0.8069 0.80690000 0.9991 1.0000
7       2 - 5 0.0118 0.03933333 0.0751 0.1177
8       3 - 4 0.5608 0.70100000 0.9738 1.0000
9       3 - 5 0.0235 0.05875000 0.1380 0.2355
10      4 - 5 0.0071 0.03550000 0.0475 0.0709</code></pre>
</div>
</div>
<p>위의 표를 수정이 되지 않은 LSD 방법으로 계산된 p-값을 기준으로 정렬하면 다음과 같다.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a>comp_pval <span class="sc">%&gt;%</span> dplyr<span class="sc">::</span><span class="fu">arrange</span>(LSD)</span></code><button title="클립보드 복사" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>   comp_group    LSD     FDR_BH    HSD   Bonf
1       1 - 5 0.0010 0.01000000 0.0073 0.0097
2       4 - 5 0.0071 0.03550000 0.0475 0.0709
3       2 - 5 0.0118 0.03933333 0.0751 0.1177
4       3 - 5 0.0235 0.05875000 0.1380 0.2355
5       1 - 3 0.1376 0.27520000 0.5377 1.0000
6       1 - 2 0.2405 0.40083333 0.7392 1.0000
7       1 - 4 0.3458 0.49400000 0.8629 1.0000
8       3 - 4 0.5608 0.70100000 0.9738 1.0000
9       2 - 3 0.7341 0.80690000 0.9966 1.0000
10      2 - 4 0.8069 0.80690000 0.9991 1.0000</code></pre>
</div>
</div>
<p>위 표에서 볼 수 있듯이 다중비교 수정을 적용하지 않는 LSD 방법에서는 4개의 가설이 유의하다고 나타났다. FDR의 BH 절차를 적용하면 3개의 가설이 유의하다고 나타났으며 Tukey의 HSD 에서는 2개의 가설이 유의하다고 나타났다. 본페로니 수정 방법에서는 유의한 차이가 하나의 가설에서만 나타났다.</p>
<p>본페로니 수정은 가장 보수적이며 FDR의 BH 절차는 다중비교 방법 중 상당히 유연한 방법이다.</p>
</section>
<section id="dunnett-비교" class="level3" data-number="7.6.5">
<h3 data-number="7.6.5" class="anchored" data-anchor-id="dunnett-비교"><span class="header-section-number">7.6.5</span> Dunnett 비교</h3>
<p><a href="#exm-dunnett" class="quarto-xref">보기&nbsp;<span>7.1</span></a> 에서 설명하듯이 임상실험에서는 하나의 기준집단 또는 제어집단(control group)을 다른 여러 개의 집단과 비교하는 경우가 흔하다. 이러한 경우 사용할 수 있는 다중비교 방법이 Dunnett의 방법이다.</p>
<p>Dunnett의 방법은 패키지 <code>DescTools</code> 의 <code>DunnettTest()</code> 함수로 실행할 수 있다.</p>
<p>이제 예를 들어 저혈당 실험에서 그룹 1 을 기준 집단이라고 하고 나머지 4개의 집단과 평균이 다른지 검정하고 싶다고 하자. 다음과 같이 반응변수, 그룹변수 그리고 기준집단(<code>control</code>)의 값을 지정해 주면 된다.</p>
<p>첫 번쨰 기준집단(<code>control</code>)은 5번째 집단과 유의한 차이가 있다.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a>test4 <span class="ot">&lt;-</span> <span class="fu">DunnettTest</span>(diabetes<span class="sc">$</span>response, diabetes<span class="sc">$</span>treat, <span class="at">control =</span> <span class="dv">1</span>, <span class="at">conf.level =</span> <span class="fl">0.95</span>)</span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a>test4</span></code><button title="클립보드 복사" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
  Dunnett's test for comparing several treatments with a control :  
    95% family-wise confidence level

$`1`
      diff     lwr.ci    upr.ci   pval    
2-1 -2.825  -9.133182  3.483182 0.5694    
3-1 -3.625  -9.933182  2.683182 0.3639    
4-1 -2.250  -8.558182  4.058182 0.7334    
5-1 -9.450 -15.758182 -3.141818 0.0035 ** 

---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</code></pre>
</div>
</div>


</section>
</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const onCopySuccess = function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "복사완료!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "복사완료!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  }
  const getTextToCopy = function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
    text: getTextToCopy
  });
  clipboard.on('success', onCopySuccess);
  if (window.document.getElementById('quarto-embedded-source-code-modal')) {
    // For code content inside modals, clipBoardJS needs to be initialized with a container option
    // TODO: Check when it could be a function (https://github.com/zenorocha/clipboard.js/issues/860)
    const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
      text: getTextToCopy,
      container: window.document.getElementById('quarto-embedded-source-code-modal')
    });
    clipboardModal.on('success', onCopySuccess);
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp('/' + window.location.host + '/');
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
<nav class="page-navigation">
  <div class="nav-page nav-page-previous">
      <a href="../notes/ancova.html" class="pagination-link" aria-label="공분산분석">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text"><span class="chapter-number">6</span>&nbsp; <span class="chapter-title">공분산분석</span></span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
      <a href="../notes/repeatmeasure.html" class="pagination-link" aria-label="반복측정자료">
        <span class="nav-page-text"><span class="chapter-number">8</span>&nbsp; <span class="chapter-title">반복측정자료</span></span> <i class="bi bi-arrow-right-short"></i>
      </a>
  </div>
</nav>
</div> <!-- /content -->




</body></html>